# Phase 2: Match Cycle

## Match Planning & Execution Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ”„ MATCH PLANNING & EXECUTION                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                                           â”‚
            â†“                                           â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  AUTOMATIC MODE    â”‚                    â”‚   MANUAL MODE      â”‚
   â”‚  (Match Scheduler) â”‚                    â”‚   (God Mode)       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                           â”‚
            â†“                                           â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ AI suggests        â”‚                    â”‚ Admin manually     â”‚
   â”‚ matchups based on: â”‚                    â”‚ drags players to:  â”‚
   â”‚ â€¢ Teams not played â”‚                    â”‚ â€¢ TEAM A           â”‚
   â”‚ â€¢ Game variety     â”‚                    â”‚ â€¢ TEAM B           â”‚
   â”‚ â€¢ Player rotation  â”‚                    â”‚                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                           â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Game Added to Queue     â”‚
                    â”‚  Status: "queued"        â”‚
                    â”‚                          â”‚
                    â”‚  Queue Entry:            â”‚
                    â”‚  â€¢ Game: "CS2"           â”‚
                    â”‚  â€¢ PlayType: "2v2"       â”‚
                    â”‚  â€¢ TEAM A: [Players]     â”‚
                    â”‚  â€¢ TEAM B: [Players]     â”‚
                    â”‚  â€¢ Notes                 â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  âš”ï¸ MATCH PLAYED         â”‚
                    â”‚  (Outside the system)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Admin: "Confirm Result" â”‚
                    â”‚  Tab in god.html         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Select Winner(s):                         â”‚
        â”‚  â€¢ For 2-team match: 1 winner              â”‚
        â”‚  â€¢ For 3+ teams: Check all allied winners  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  confirmGameResult() executes:  â”‚
            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            â”‚  1. âœ… Record game in history   â”‚
            â”‚  2. ğŸ“ˆ Update team.gamesWon     â”‚
            â”‚  3. ğŸ¯ Create turn queue        â”‚
            â”‚  4. ğŸ Start first team's turn  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Automatic vs Manual Mode

### Automatic Mode (Match Scheduler)
- AI-powered matchup suggestions
- Considers teams that haven't played together
- Rotates game types for variety
- Ensures all players get equal playtime
- **File**: `scripts/match-scheduler.js`

### Manual Mode (God Mode)
- Full admin control
- Drag & drop interface
- Can create any matchup combination
- Override AI suggestions
- **File**: `scripts/god-scripts.js`

## Queue System

Games are added to `gameState.gameQueue[]` with structure:

```javascript
{
  id: 1234567890,
  game: "CS2",
  playType: "2v2",
  teams: [
    {
      id: "TEAM_A",
      name: "TEAM A",
      players: [
        {
          name: "Player 1",
          originalTeamId: 1,
          originalTeamName: "Team Alpha",
          originalTeamColor: "#ff4444"
        },
        // ...
      ]
    },
    {
      id: "TEAM_B",
      name: "TEAM B",
      players: [/* ... */]
    }
  ],
  notes: "Optional admin notes",
  status: "queued",
  createdAt: "2024-01-15T10:30:00.000Z"
}
```

## Result Confirmation

When admin confirms a match result:

1. **Identify Winners**: Can select multiple teams (allied winners)
2. **Extract Original Team IDs**: Map virtual teams (TEAM_A/B) back to real teams
3. **Create Game History Entry**: Record full match details
4. **Update Team Stats**: Increment `gamesWon` for all winning teams
5. **Create Turn Queue**: All winning teams get added to turn queue
6. **Start First Turn**: Begin [Phase 3: Hex Board Placement](phase-3-hex-board-placement.md)

## Multi-Team Winner Support (NEW!)

**Key Innovation**: When multiple teams win as allies, ALL get turns:

```javascript
// Example: Team 2 & Team 5 win together
winningTeamIds = [2, 5];

// Turn queue created
gameState.turnQueue = [
  { teamId: 2, gameResultId: 7 },
  { teamId: 5, gameResultId: 7 }
];

// Team 2 goes first, then Team 5
```

## Key Functions

- `addGameToQueue()` - Add match to queue (god-scripts.js:1420+)
- `confirmGameResult()` - Process match result (god-scripts.js:1578+)
- `loadQueuedGame()` - Load game for confirmation (god-scripts.js:1499+)

## Next Phase

After confirming a match result, proceed to [Phase 3: Hex Board Placement](phase-3-hex-board-placement.md).
