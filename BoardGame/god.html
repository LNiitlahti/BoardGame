
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>God Mode - Board Game Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            min-height: 100vh;
            color: white;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 350px 1fr 350px;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .panel h3 {
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .board-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .hex-board {
            position: relative;
            width: 700px;
            height: 700px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hex {
            position: absolute;
            width: 45px;
            height: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .hex-inner {
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .hex:hover .hex-inner {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.15);
        }

        .hex.starting-location .hex-inner {
            background: rgba(255, 215, 0, 0.4);
            border-color: #ffd700;
        }

        .hex.heart-hex .hex-inner {
            background: rgba(255, 20, 147, 0.4);
            border-color: #ff1493;
        }

        .hex.center .hex-inner {
            background: rgba(138, 43, 226, 0.5);
            border-color: #8a2be2;
        }

        .hex.can-place .hex-inner {
            background: rgba(0, 255, 0, 0.4) !important;
            border-color: #00ff00 !important;
            animation: pulse-green 1s infinite;
        }

        .hex.team1 .hex-inner { background: rgba(255, 68, 68, 0.9); border-color: #ff4444; color: white; }
        .hex.team2 .hex-inner { background: rgba(68, 255, 68, 0.9); border-color: #44ff44; color: black; }
        .hex.team3 .hex-inner { background: rgba(68, 68, 255, 0.9); border-color: #4444ff; color: white; }
        .hex.team4 .hex-inner { background: rgba(255, 255, 68, 0.9); border-color: #ffff44; color: black; }
        .hex.team5 .hex-inner { background: rgba(255, 68, 255, 0.9); border-color: #ff44ff; color: white; }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #ffd700;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 0.95rem;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .btn.primary {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #333;
        }

        .btn.danger {
            background: linear-gradient(135deg, #ff4444 0%, #cc3333 100%);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .team-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid;
            margin-bottom: 15px;
        }

        .team-card.team1 { border-left-color: #ff4444; }
        .team-card.team2 { border-left-color: #44ff44; }
        .team-card.team3 { border-left-color: #4444ff; }
        .team-card.team4 { border-left-color: #ffff44; }
        .team-card.team5 { border-left-color: #ff44ff; }

        .team-card.active {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #ffd700;
        }

        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
            display: none;
        }

        .status-message.success {
            background: rgba(74, 222, 128, 0.2);
            border: 1px solid #4ade80;
            color: #4ade80;
        }

        .status-message.error {
            background: rgba(248, 113, 113, 0.2);
            border: 1px solid #f87171;
            color: #f87171;
        }

        .status-message.info {
            background: rgba(96, 165, 250, 0.2);
            border: 1px solid #60a5fa;
            color: #60a5fa;
        }

        .game-log {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            border-radius: 10px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-left: 3px solid #ffd700;
            padding-left: 10px;
        }

        .log-entry.error {
            border-left-color: #f87171;
            color: #f87171;
        }

        .log-entry.success {
            border-left-color: #4ade80;
            color: #4ade80;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 800;
            color: #ffd700;
        }

        .stat-label {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        @keyframes pulse-green {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        @media (max-width: 1400px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .hex-board {
                width: 500px;
                height: 500px;
            }
            
            .hex {
                width: 35px;
                height: 31px;
            }
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            z-index: 1000;
        }

        .connection-status.connected {
            background: rgba(74, 222, 128, 0.2);
            border: 1px solid #4ade80;
            color: #4ade80;
        }

        .connection-status.disconnected {
            background: rgba(248, 113, 113, 0.2);
            border: 1px solid #f87171;
            color: #f87171;
        }
    </style>
</head>
<body>
    <div id="connectionStatus" class="connection-status disconnected">üî¥ Not Connected</div>
    
    <div class="container">
        <div class="header">
            <h1>üëë God Mode - Admin Panel</h1>
            <p>Complete control over the board game system</p>
        </div>

        <div class="status-message" id="statusMessage"></div>

        <div class="main-grid">
            <!-- Left Sidebar: Game Setup & Controls -->
            <div>
                <div class="panel">
                    <h3>üéÆ Game Setup</h3>
                    <div class="form-group">
                        <label>Game ID</label>
                        <input type="text" id="gameId" placeholder="my-game-session">
                    </div>
                    <div class="form-group">
                        <label>Players (comma separated)</label>
                        <textarea id="playerNames" rows="3" placeholder="Alice, Bob, Charlie, Diana, Eve, Frank"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Win Condition (Points)</label>
                        <input type="number" id="winCondition" value="50" min="10" max="200">
                    </div>
                    <button class="btn primary" onclick="initializeGame()">üöÄ Initialize Game</button>
                    <button class="btn" onclick="loadGame()">üìÇ Load Game</button>
                    <button class="btn danger" onclick="resetGame()">üîÑ Reset Game</button>
                </div>

                <div class="panel" style="margin-top: 20px;">
                    <h3>üìä Game Statistics</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number" id="statGamesPlayed">0</div>
                            <div class="stat-label">Games Played</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="statRound">0</div>
                            <div class="stat-label">Current Round</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="statPlates">0</div>
                            <div class="stat-label">Plates on Board</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="statHearts">0</div>
                            <div class="stat-label">Hearts Controlled</div>
                        </div>
                    </div>
                </div>

                <div class="panel" style="margin-top: 20px;">
                    <h3>üèÜ Add Game Result</h3>
                    <div class="form-group">
                        <label>Game Type</label>
                        <select id="gameType">
                            <option value="CS2">Counter-Strike 2</option>
                            <option value="Dota2">Dota 2</option>
                            <option value="Valorant">Valorant</option>
                            <option value="StarCraft2">StarCraft 2</option>
                            <option value="Predecessor">Predecessor</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Match Type</label>
                        <select id="playType">
                            <option value="1v1">1v1</option>
                            <option value="2v2">2v2</option>
                            <option value="3v3">3v3</option>
                            <option value="5v5">5v5</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Winning Team</label>
                        <select id="winningTeam">
                            <option value="">Select winner...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Notes (optional)</label>
                        <input type="text" id="gameNotes" placeholder="Any special notes...">
                    </div>
                    <button class="btn primary" onclick="addGameResult()">‚úÖ Add Result & Start Turn</button>
                </div>
            </div>

            <!-- Center: Game Board -->
            <div class="board-container">
                <div class="panel" style="width: 100%;">
                    <h3 style="text-align: center;">üéØ Game Board</h3>
                    <div id="currentTurnInfo" style="text-align: center; padding: 15px; background: rgba(255, 215, 0, 0.2); border-radius: 10px; margin: 15px 0;">
                        <strong>‚è≥ No active turn</strong>
                    </div>
                    <div style="text-align: center; margin-bottom: 15px;">
                        <button class="btn" onclick="highlightValidPlacements()" style="width: auto; display: inline-block; margin: 5px;">
                            üîç Show Valid Placements
                        </button>
                        <button class="btn" onclick="clearHighlights()" style="width: auto; display: inline-block; margin: 5px;">
                            üßπ Clear Highlights
                        </button>
                    </div>
                </div>

                <div class="hex-board" id="hexBoard">
                    <!-- Hex grid generated here -->
                </div>

                <div class="panel" style="width: 100%;">
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; font-size: 0.85rem;">
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <div style="width: 20px; height: 18px; background: rgba(255, 215, 0, 0.5); clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);"></div>
                            Starting Corner
                        </div>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <div style="width: 20px; height: 18px; background: rgba(255, 20, 147, 0.5); clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);"></div>
                            Heart Hex (+1/turn)
                        </div>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <div style="width: 20px; height: 18px; background: rgba(138, 43, 226, 0.5); clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);"></div>
                            Mountain Heart (+2/turn)
                        </div>
                        <div style="display: flex; align-items: center; gap: 5px;">
                            <div style="width: 20px; height: 18px; background: rgba(0, 255, 0, 0.4); clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);"></div>
                            Can Place Here
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar: Teams & Activity -->
            <div>
                <div class="panel">
                    <h3>üë• Team Rankings</h3>
                    <div id="teamsList">
                        <p style="text-align: center; opacity: 0.7; font-style: italic;">Initialize game to see teams</p>
                    </div>
                </div>

                <div class="panel" style="margin-top: 20px;">
                    <h3>üìú Game Log</h3>
                    <div class="game-log" id="gameLog">
                        <div class="log-entry">System initialized. Ready to start.</div>
                    </div>
                    <button class="btn" onclick="clearLog()" style="margin-top: 10px;">üóëÔ∏è Clear Log</button>
                </div>

                <div class="panel" style="margin-top: 20px;">
                    <h3>üíæ Data Management</h3>
                    <button class="btn" onclick="exportGameState()">üì• Export Game State</button>
                    <button class="btn" onclick="saveGameState()">üíæ Save to Firebase</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK - Load from external file -->
    <script src="scripts/firebase.js"></script>

    <!-- Wait for Firebase to initialize -->
    <script>
        // Wait for Firebase to be ready
        window.addEventListener('load', function() {
            // Check if Firebase is initialized
            if (window.firebaseDB && window.firebaseDoc && window.firebaseSetDoc) {
                document.getElementById('connectionStatus').className = 'connection-status connected';
                document.getElementById('connectionStatus').textContent = 'üü¢ Firebase Connected';
                addLog('Firebase connected successfully', 'success');
            } else {
                // Wait a bit more if needed
                setTimeout(() => {
                    if (window.firebaseDB && window.firebaseDoc && window.firebaseSetDoc) {
                        document.getElementById('connectionStatus').className = 'connection-status connected';
                        document.getElementById('connectionStatus').textContent = 'üü¢ Firebase Connected';
                        addLog('Firebase connected successfully', 'success');
                    } else {
                        document.getElementById('connectionStatus').className = 'connection-status disconnected';
                        document.getElementById('connectionStatus').textContent = 'üî¥ Firebase Connection Failed';
                        addLog('Firebase connection failed - check firebase.js', 'error');
                    }
                }, 2000);
            }
        });
    </script>

    <script>
        // Game state
        let gameState = null;
        let activeListener = null;

        // Hex coordinate system
        function generateHexCoordinates() {
            const coordinates = [];
            for (let q = -5; q <= 5; q++) {
                const r1 = Math.max(-5, -q - 5);
                const r2 = Math.min(5, -q + 5);
                for (let r = r1; r <= r2; r++) {
                    coordinates.push([q, r]);
                }
            }
            return coordinates;
        }

        function hexToPixel(q, r, size = 24, centerX = 350, centerY = 350) {
            const x = size * 3/2 * q;
            const y = size * Math.sqrt(3) * (r + q/2);
            return [x + centerX, y + centerY];
        }

        function getHexType(q, r) {
            const coord = `q${q}r${r}`;
            const startingLocs = ['q0r-5', 'q5r-5', 'q5r0', 'q0r5', 'q-5r5', 'q-5r0'];
            if (startingLocs.includes(coord)) return 'starting-location';
            
            const heartHexes = gameState?.heartHexes || ['q2r-4', 'q4r-2', 'q2r2', 'q-2r4', 'q-4r2', 'q-2r-2'];
            if (heartHexes.includes(coord)) return 'heart-hex';
            
            if (coord === 'q0r0') return 'center';
            return 'normal';
        }

        function getHexNeighbors(q, r) {
            const directions = [[1, 0], [1, -1], [0, -1], [-1, 0], [-1, 1], [0, 1]];
            return directions.map(([dq, dr]) => {
                const nq = q + dq;
                const nr = r + dr;
                return `q${nq}r${nr}`;
            }).filter(coord => {
                const [nq, nr] = coord.match(/-?\d+/g).map(Number);
                return Math.abs(nq) <= 5 && Math.abs(nr) <= 5 && Math.abs(nq + nr) <= 5;
            });
        }

        function canPlaceAt(q, r, teamId) {
            if (!gameState) return false;
            const coord = `q${q}r${r}`;
            
            if (gameState.board[coord]) return false;
            
            const teamPlates = Object.entries(gameState.board)
                .filter(([_, occupier]) => occupier === teamId)
                .map(([coord, _]) => coord);
            
            if (teamPlates.length === 0) {
                const startingLocs = ['q0r-5', 'q5r-5', 'q5r0', 'q0r5', 'q-5r5', 'q-5r0'];
                return startingLocs.includes(coord);
            }
            
            const neighbors = getHexNeighbors(q, r);
            return neighbors.some(neighborCoord => teamPlates.includes(neighborCoord));
        }

        // Initialize hex board
        function initializeHexBoard() {
            const hexBoard = document.getElementById('hexBoard');
            hexBoard.innerHTML = '';
            
            const coordinates = generateHexCoordinates();
            coordinates.forEach(([q, r]) => {
                const hex = document.createElement('div');
                hex.className = `hex ${getHexType(q, r)}`;
                hex.id = `hex-${q}-${r}`;
                
                const [x, y] = hexToPixel(q, r);
                hex.style.left = `${x}px`;
                hex.style.top = `${y}px`;
                
                const hexInner = document.createElement('div');
                hexInner.className = 'hex-inner';
                
                const coord = `q${q}r${r}`;
                const occupier = gameState?.board?.[coord];
                
                if (occupier) {
                    const team = gameState.teams.find(t => t.id === occupier);
                    hexInner.textContent = team ? team.name.slice(-1) : occupier;
                    hex.classList.add(`team${occupier}`);
                } else {
                    hexInner.textContent = `${q},${r}`;
                }
                
                hex.appendChild(hexInner);
                hex.addEventListener('click', () => handleHexClick(q, r));
                hexBoard.appendChild(hex);
            });
        }

        function handleHexClick(q, r) {
            if (!gameState?.currentTurn) {
                showStatus('No active turn. Add a game result first.', 'error');
                return;
            }
            
            const teamId = gameState.currentTurn.teamId;
            const coord = `q${q}r${r}`;
            
            if (!canPlaceAt(q, r, teamId)) {
                showStatus(`Cannot place plate at ${coord}`, 'error');
                return;
            }
            
            if (confirm(`Place plate for Team ${teamId} at ${coord}?`)) {
                placePlate(q, r, teamId);
            }
        }

        async function placePlate(q, r, teamId) {
            const coord = `q${q}r${r}`;
            
            gameState.board[coord] = teamId;
            
            // Check for heart hex capture
            if (gameState.heartHexes?.includes(coord)) {
                gameState.heartHexControl = gameState.heartHexControl || {};
                gameState.heartHexControl[coord] = teamId;
                addLog(`‚ù§Ô∏è Team ${teamId} captured heart hex ${coord}!`, 'success');
            }
            
            calculatePoints();
            gameState.currentTurn.needsPlacement = false;
            gameState.currentTurn = null;
            
            checkWinCondition();
            await saveGameState();
            
            addLog(`‚úÖ Team ${teamId} placed plate at ${coord}`, 'success');
            updateDisplay();
        }

        function calculatePoints() {
            if (!gameState?.teams) return;
            
            gameState.teams.forEach(team => {
                let points = 0;
                
                Object.entries(gameState.board || {}).forEach(([coord, occupier]) => {
                    if (occupier === team.id) {
                        const [q, r] = coord.match(/-?\d+/g).map(Number);
                        const hexType = getHexType(q, r);
                        points += (hexType === 'center' || hexType === 'heart-hex') ? 2 : 1;
                    }
                });
                
                Object.entries(gameState.heartHexControl || {}).forEach(([heartHex, controllingTeam]) => {
                    if (controllingTeam === team.id) {
                        points += heartHex === 'q0r0' ? 2 : 1;
                    }
                });
                
                team.points = points;
            });
        }

        function checkWinCondition() {
            if (!gameState?.teams) return;
            
            const winner = gameState.teams.find(team => team.points >= gameState.winCondition);
            if (winner) {
                gameState.gamePhase = 'finished';
                gameState.finishedAt = new Date().toISOString();
                addLog(`üèÜ GAME OVER! ${winner.name} wins with ${winner.points} points!`, 'success');
                showStatus(`üèÜ ${winner.name} wins the game!`, 'success');
            }
        }

        async function initializeGame() {
            const gameId = document.getElementById('gameId').value.trim();
            const playerNames = document.getElementById('playerNames').value
                .split(',')
                .map(name => name.trim())
                .filter(name => name);
            const winCondition = parseInt(document.getElementById('winCondition').value);
            
            if (!gameId || playerNames.length < 2) {
                showStatus('Please enter Game ID and at least 2 players', 'error');
                return;
            }
            
            const teamCount = Math.min(5, Math.ceil(playerNames.length / 2));
            const players = playerNames.map((name, index) => ({
                id: index + 1,
                name: name,
                team: Math.floor(index / Math.ceil(playerNames.length / teamCount)) + 1,
                points: 0
            }));
            
            const teams = [];
            for (let i = 1; i <= teamCount; i++) {
                const teamPlayers = players.filter(p => p.team === i);
                teams.push({
                    id: i,
                    name: `Team ${i}`,
                    players: teamPlayers,
                    points: 0,
                    gamesWon: 0
                });
            }
            
            gameState = {
                gameId: gameId,
                players: players,
                teams: teams,
                board: {},
                heartHexes: ['q2r-4', 'q4r-2', 'q2r2', 'q-2r4', 'q-4r2', 'q-2r-2'],
                heartHexControl: {},
                currentRound: 0,
                gamesPlayed: 0,
                winCondition: winCondition,
                gameHistory: [],
                currentTurn: null,
                gamePhase: 'playing',
                gameTypes: ['CS2', 'Dota2', 'Valorant', 'StarCraft2', 'Predecessor'],
                playTypes: ['1v1', '2v2', '3v3', '5v5'],
                createdAt: new Date().toISOString(),
                initialized: true
            };
            
            await saveGameState();
            updateDisplay();
            addLog(`üöÄ Game "${gameId}" initialized with ${playerNames.length} players`, 'success');
            showStatus('Game initialized successfully!', 'success');
        }

        async function loadGame() {
            const gameId = document.getElementById('gameId').value.trim();
            if (!gameId) {
                showStatus('Please enter a Game ID', 'error');
                return;
            }
            
            try {
                const docRef = window.firebaseDoc(window.firebaseDB, 'games', gameId);
                
                // Set up real-time listener
                if (activeListener) activeListener();
                
                activeListener = window.firebaseOnSnapshot(docRef, (docSnap) => {
                    if (docSnap.exists()) {
                        gameState = docSnap.data();
                        updateDisplay();
                        addLog(`üìÇ Game "${gameId}" loaded`, 'success');
                        showStatus('Game loaded successfully!', 'success');
                    } else {
                        showStatus(`Game "${gameId}" not found`, 'error');
                    }
                });
            } catch (error) {
                console.error('Load error:', error);
                showStatus('Error loading game: ' + error.message, 'error');
            }
        }

        async function saveGameState() {
            if (!gameState?.gameId) return;
            
            try {
                const docRef = window.firebaseDoc(window.firebaseDB, 'games', gameState.gameId);
                await window.firebaseSetDoc(docRef, gameState);
                addLog('üíæ Game state saved', 'success');
            } catch (error) {
                console.error('Save error:', error);
                showStatus('Error saving game', 'error');
            }
        }

        async function addGameResult() {
            if (!gameState) {
                showStatus('Initialize game first!', 'error');
                return;
            }
            
            const game = document.getElementById('gameType').value;
            const playType = document.getElementById('playType').value;
            const winningTeamId = parseInt(document.getElementById('winningTeam').value);
            const notes = document.getElementById('gameNotes').value;
            
            if (!winningTeamId) {
                showStatus('Please select a winning team', 'error');
                return;
            }
            
            const result = {
                id: (gameState.gameHistory?.length || 0) + 1,
                game: game,
                playType: playType,
                winningTeamId: winningTeamId,
                notes: notes,
                timestamp: new Date().toISOString()
            };
            
            gameState.gameHistory = gameState.gameHistory || [];
            gameState.gameHistory.push(result);
            gameState.gamesPlayed = (gameState.gamesPlayed || 0) + 1;
            gameState.currentRound = Math.ceil(gameState.gamesPlayed / gameState.teams.length);
            
            const winningTeam = gameState.teams.find(t => t.id === winningTeamId);
            if (winningTeam) {
                winningTeam.gamesWon = (winningTeam.gamesWon || 0) + 1;
            }
            
            // Start winner's turn
            gameState.currentTurn = {
                teamId: winningTeamId,
                needsPlacement: true,
                gameResultId: result.id,
                startTime: new Date().toISOString()
            };
            
            await saveGameState();
            updateDisplay();
            
            addLog(`üèÜ ${winningTeam?.name} won ${game} ${playType}`, 'success');
            showStatus(`${winningTeam?.name}'s turn to place a plate!`, 'info');
            
            // Clear form
            document.getElementById('gameNotes').value = '';
        }

        function resetGame() {
            if (!confirm('Are you sure you want to reset the entire game? This cannot be undone.')) {
                return;
            }
            
            if (activeListener) activeListener();
            gameState = null;
            
            document.getElementById('gameId').value = '';
            document.getElementById('playerNames').value = '';
            document.getElementById('winCondition').value = '50';
            
            updateDisplay();
            addLog('üîÑ Game reset', 'success');
            showStatus('Game reset complete', 'success');
        }

        function updateDisplay() {
            initializeHexBoard();
            updateTeamsList();
            updateCurrentTurnInfo();
            updateStatistics();
            updateWinningTeamDropdown();
        }

        function updateTeamsList() {
            const container = document.getElementById('teamsList');
            
            if (!gameState?.teams) {
                container.innerHTML = '<p style="text-align: center; opacity: 0.7; font-style: italic;">Initialize game to see teams</p>';
                return;
            }
            
            const sortedTeams = [...gameState.teams].sort((a, b) => b.points - a.points);
            
            container.innerHTML = sortedTeams.map((team, index) => {
                const isActive = gameState.currentTurn?.teamId === team.id;
                const rankIcon = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : `${index + 1}.`;
                
                return `
                    <div class="team-card team${team.id} ${isActive ? 'active' : ''}">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${rankIcon} ${team.name}</strong><br>
                                <small>${team.players.map(p => p.name).join(' & ')}</small>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.3rem; font-weight: bold;">${team.points}</div>
                                <div style="font-size: 0.8rem; opacity: 0.8;">${team.gamesWon || 0} wins</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateCurrentTurnInfo() {
            const container = document.getElementById('currentTurnInfo');
            
            if (!gameState?.currentTurn) {
                container.innerHTML = '<strong>‚è≥ No active turn - Add a game result to start</strong>';
                return;
            }
            
            const team = gameState.teams.find(t => t.id === gameState.currentTurn.teamId);
            container.innerHTML = `
                <strong>üéØ ${team?.name}'s Turn</strong><br>
                <small>${team?.players.map(p => p.name).join(' & ')}</small><br>
                <div style="margin-top: 8px; color: #4ade80;">
                    ${gameState.currentTurn.needsPlacement ? 'üìç Click a green hex to place plate' : '‚úÖ Placement complete'}
                </div>
            `;
        }

        function updateStatistics() {
            if (!gameState) {
                document.getElementById('statGamesPlayed').textContent = '0';
                document.getElementById('statRound').textContent = '0';
                document.getElementById('statPlates').textContent = '0';
                document.getElementById('statHearts').textContent = '0';
                return;
            }
            
            document.getElementById('statGamesPlayed').textContent = gameState.gamesPlayed || 0;
            document.getElementById('statRound').textContent = gameState.currentRound || 0;
            document.getElementById('statPlates').textContent = Object.keys(gameState.board || {}).length;
            document.getElementById('statHearts').textContent = Object.keys(gameState.heartHexControl || {}).length;
        }

        function updateWinningTeamDropdown() {
            const select = document.getElementById('winningTeam');
            
            if (!gameState?.teams) {
                select.innerHTML = '<option value="">Initialize game first...</option>';
                return;
            }
            
            select.innerHTML = '<option value="">Select winner...</option>' +
                gameState.teams.map(team => 
                    `<option value="${team.id}">${team.name} (${team.players.map(p => p.name).join(' & ')})</option>`
                ).join('');
        }

        function highlightValidPlacements() {
            if (!gameState?.currentTurn) {
                showStatus('No active turn', 'error');
                return;
            }
            
            clearHighlights();
            
            const teamId = gameState.currentTurn.teamId;
            const coordinates = generateHexCoordinates();
            
            coordinates.forEach(([q, r]) => {
                if (canPlaceAt(q, r, teamId)) {
                    const hexElement = document.getElementById(`hex-${q}-${r}`);
                    if (hexElement) {
                        hexElement.classList.add('can-place');
                    }
                }
            });
            
            addLog(`üîç Showing valid placements for Team ${teamId}`);
        }

        function clearHighlights() {
            document.querySelectorAll('.hex.can-place').forEach(hex => {
                hex.classList.remove('can-place');
            });
        }

        function exportGameState() {
            if (!gameState) {
                showStatus('No game to export', 'error');
                return;
            }
            
            const dataStr = JSON.stringify(gameState, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `game-${gameState.gameId}-${new Date().toISOString().slice(0, 10)}.json`;
            link.click();
            
            addLog('üì• Game state exported', 'success');
            showStatus('Game exported successfully!', 'success');
        }

        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message ${type}`;
            statusEl.style.display = 'block';
            
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 5000);
        }

        function addLog(message, type = 'info') {
            const log = document.getElementById('gameLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.innerHTML = `<span style="opacity: 0.7;">[${timestamp}]</span> ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function clearLog() {
            document.getElementById('gameLog').innerHTML = '<div class="log-entry">Log cleared...</div>';
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üëë God Mode Admin Panel Ready');
            
            // Check for game ID in URL
            const urlParams = new URLSearchParams(window.location.search);
            const gameId = urlParams.get('game');
            if (gameId) {
                document.getElementById('gameId').value = gameId;
                loadGame();
            }
            
            // Auto-generate game ID if empty
            if (!document.getElementById('gameId').value) {
                const dateStr = new Date().toISOString().slice(0, 10);
                document.getElementById('gameId').value = `game-${dateStr}`;
            }
        });

        // Auto-save every 30 seconds
        setInterval(() => {
            if (gameState?.initialized) {
                saveGameState();
            }
        }, 30000);
    </script>
</body>
</html>